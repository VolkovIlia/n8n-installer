{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Telegram Bot Commands Schema",
  "description": "Command interface for vpnTelegram bot",
  "version": "1.0.0",

  "definitions": {
    "Command": {
      "type": "object",
      "required": ["name", "description", "handler", "auth_required"],
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^/[a-z_]+$",
          "description": "Command name with leading slash"
        },
        "description": {
          "type": "string",
          "description": "Human-readable command description"
        },
        "handler": {
          "type": "string",
          "description": "Python handler function name"
        },
        "auth_required": {
          "type": "boolean",
          "description": "Whether command requires whitelist authentication"
        },
        "parameters": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Parameter"
          }
        }
      }
    },

    "Parameter": {
      "type": "object",
      "required": ["name", "type", "required"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Parameter name"
        },
        "type": {
          "type": "string",
          "enum": ["string", "integer", "boolean"],
          "description": "Parameter data type"
        },
        "required": {
          "type": "boolean",
          "description": "Whether parameter is mandatory"
        },
        "description": {
          "type": "string",
          "description": "Parameter description"
        },
        "default": {
          "description": "Default value if not provided"
        }
      }
    },

    "Response": {
      "type": "object",
      "required": ["text", "type"],
      "properties": {
        "text": {
          "type": "string",
          "description": "Response message text (supports Telegram Markdown)"
        },
        "type": {
          "type": "string",
          "enum": ["text", "document", "photo", "error"],
          "description": "Response content type"
        },
        "attachments": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": ["qr_code", "config_file"]
              },
              "data": {
                "type": "string",
                "description": "File data or path"
              }
            }
          }
        }
      }
    }
  },

  "commands": [
    {
      "name": "/start",
      "description": "Welcome message and bot introduction",
      "handler": "handle_start",
      "auth_required": false,
      "parameters": [],
      "response_example": {
        "text": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ VPN Bot!\n\n–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n/request - –ó–∞–ø—Ä–æ—Å–∏—Ç—å VPN –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é\n/status - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å VPN\n/help - –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º",
        "type": "text"
      }
    },

    {
      "name": "/request",
      "description": "Request new VPN configuration",
      "handler": "handle_request",
      "auth_required": true,
      "parameters": [
        {
          "name": "device_name",
          "type": "string",
          "required": false,
          "description": "Optional device identifier (e.g., 'laptop', 'phone')",
          "default": null
        }
      ],
      "response_example": {
        "text": "‚úÖ VPN –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞!\n\n–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞: user_123456_1730000000\nIP –∞–¥—Ä–µ—Å: 10.8.0.2\n\n–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR –∫–æ–¥ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.",
        "type": "photo",
        "attachments": [
          {
            "type": "qr_code",
            "data": "qr_code_image.png"
          },
          {
            "type": "config_file",
            "data": "user_123456_1730000000.conf"
          }
        ]
      },
      "error_responses": [
        {
          "condition": "user_not_whitelisted",
          "text": "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.",
          "type": "error"
        },
        {
          "condition": "wg_easy_api_error",
          "text": "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É –ø–æ–∑–∂–µ.",
          "type": "error"
        },
        {
          "condition": "client_already_exists",
          "text": "‚úÖ –£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /status –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.",
          "type": "text"
        }
      ]
    },

    {
      "name": "/revoke",
      "description": "Revoke existing VPN configuration",
      "handler": "handle_revoke",
      "auth_required": true,
      "parameters": [],
      "response_example": {
        "text": "üóëÔ∏è –í–∞—à–∞ VPN –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞.\n\n–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–æ–º–∞–Ω–¥–æ–π /request",
        "type": "text"
      },
      "error_responses": [
        {
          "condition": "no_config_exists",
          "text": "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.",
          "type": "error"
        }
      ]
    },

    {
      "name": "/status",
      "description": "Check VPN connection status",
      "handler": "handle_status",
      "auth_required": true,
      "parameters": [],
      "response_example": {
        "text": "üìä –°—Ç–∞—Ç—É—Å VPN\n\n–ö–ª–∏–µ–Ω—Ç: user_123456_1730000000\n–°—Ç–∞—Ç—É—Å: ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω\n–ü–æ—Å–ª–µ–¥–Ω–∏–π handshake: 30 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥\n–ü–æ–ª—É—á–µ–Ω–æ: 1.2 GB\n–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: 850 MB",
        "type": "text"
      },
      "error_responses": [
        {
          "condition": "no_config_exists",
          "text": "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /request –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è.",
          "type": "error"
        },
        {
          "condition": "disconnected",
          "text": "üìä –°—Ç–∞—Ç—É—Å VPN\n\n–ö–ª–∏–µ–Ω—Ç: user_123456_1730000000\n–°—Ç–∞—Ç—É—Å: ‚ö†Ô∏è –û—Ç–∫–ª—é—á–µ–Ω\n–ü–æ—Å–ª–µ–¥–Ω–∏–π handshake: 2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥",
          "type": "text"
        }
      ]
    },

    {
      "name": "/help",
      "description": "Show detailed command help",
      "handler": "handle_help",
      "auth_required": false,
      "parameters": [],
      "response_example": {
        "text": "üìñ –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º\n\n/start - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n/request - –ó–∞–ø—Ä–æ—Å–∏—Ç—å VPN –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–æ—Ç–ø—Ä–∞–≤–∏—Ç QR –∫–æ–¥ –∏ .conf —Ñ–∞–π–ª)\n/revoke - –£–¥–∞–ª–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é\n/status - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è\n/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n\n–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ WireGuard –∫–ª–∏–µ–Ω—Ç–∞:\nWindows/macOS: https://www.wireguard.com/install/\nAndroid/iOS: –ù–∞–π–¥–∏—Ç–µ WireGuard –≤ –º–∞–≥–∞–∑–∏–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π",
        "type": "text"
      }
    }
  ],

  "internal_events": {
    "admin_revoke": {
      "description": "Administrator revokes user access (sent to user)",
      "payload": {
        "user_id": {
          "type": "integer",
          "description": "Telegram user ID"
        },
        "reason": {
          "type": "string",
          "description": "Revocation reason (optional)"
        }
      },
      "notification_text": "‚ö†Ô∏è –í–∞—à VPN –¥–æ—Å—Ç—É–ø –±—ã–ª –æ—Ç–æ–∑–≤–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.\n\n–ü—Ä–∏—á–∏–Ω–∞: {reason}\n\n–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /request"
    }
  },

  "rate_limits": {
    "global": {
      "requests_per_minute": 60,
      "burst": 10
    },
    "per_user": {
      "/request": {
        "requests_per_hour": 5,
        "cooldown_seconds": 60
      },
      "/status": {
        "requests_per_minute": 10
      },
      "/revoke": {
        "requests_per_hour": 3
      }
    }
  },

  "error_codes": {
    "RATE_LIMIT_EXCEEDED": {
      "message": "‚è±Ô∏è –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ {cooldown} —Å–µ–∫—É–Ω–¥.",
      "http_status": 429
    },
    "UNAUTHORIZED": {
      "message": "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.",
      "http_status": 403
    },
    "INTERNAL_ERROR": {
      "message": "‚ùå –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ –±–æ—Ç–∞. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É –ø–æ–∑–∂–µ.",
      "http_status": 500
    },
    "WG_EASY_UNAVAILABLE": {
      "message": "‚ùå –°–µ—Ä–≤–∏—Å VPN –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
      "http_status": 503
    }
  }
}
